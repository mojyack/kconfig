set arch amd64
include frag/general

# arch
include frag/arch/x86/amd64
CONFIG_CPU_SUP_AMD=y
CONFIG_MZEN=y
CONFIG_NR_CPUS=24
CONFIG_X86_MCE_AMD=y
CONFIG_X86_AMD_PLATFORM_DEVICE=y

# boot
CONFIG_CMDLINE_BOOL=y
CONFIG_CMDLINE="root=PARTUUID=c77c8dec-3064-4442-96f3-a559cd8feae1 rw loglevel=3 mitigations=off fsck.mode=skip nowatchdog vfio-pci.ids=1002:6fdf,1002:aaf0 iommu=pt"

include frag/arch/x86/efi
CONFIG_EFI_STUB=y

# hwmon
CONFIG_SENSORS_K10TEMP=m
CONFIG_SENSORS_ASUS_WMI=m

# perf
CONFIG_PERF_EVENTS_INTEL_RAPL=m

# acpi
include frag/drivers/acpi

### drivers ###
# pci
include frag/drivers/pci

# mfd
CONFIG_MFD_SYSCON=y

# i2c
CONFIG_I2C_DESIGNWARE_CORE=m
CONFIG_I2C_PIIX4=m
CONFIG_I2C_DESIGNWARE_PLATFORM=m

# input
CONFIG_HIDRAW=y
CONFIG_HID_WACOM=m

# block
CONFIG_BLK_DEV_NBD=m
include frag/drivers/nvme
CONFIG_BLK_DEV_NVME=y # root device
include frag/drivers/sata
CONFIG_BLK_DEV_SR=m

# ethernet
CONFIG_ETHERNET=y
CONFIG_NET_VENDOR_INTEL=y
CONFIG_IGB=m
CONFIG_IGB_HWMON=y

# wifi
CONFIG_WLAN=y
CONFIG_WLAN_VENDOR_REALTEK=y
CONFIG_RTW88=m
CONFIG_RTW88_8822BE=m

# bluetooth
include frag/net/wireless
include frag/net/bluetooth/usb
CONFIG_BT_HCIBTUSB_BCM=y
CONFIG_BT_HCIBTUSB_RTL=y

# gpio
include frag/drivers/gpio
CONFIG_GPIO_AMDPT=m

# gpu
include frag/drivers/drm/amd

# sound
include frag/drivers/sound/hda
CONFIG_SND_HDA_GENERIC=m

include frag/drivers/sound/usb

# usb
CONFIG_USB_XHCI_HCD=m
CONFIG_USB_SERIAL=m
CONFIG_USB_SERIAL_CH341=m
CONFIG_USB_SERIAL_QUALCOMM=m

# rtc
include frag/drivers/rtc
CONFIG_RTC_DRV_CMOS=m

# platform
CONFIG_ACPI_BATTERY=m
CONFIG_ASUS_WMI=m
    CONFIG_HOTPLUG_PCI=y

# ia32
CONFIG_COMPAT_32BIT_TIME=y
CONFIG_IA32_EMULATION=y

# kvm
include frag/arch/x86/kvm
CONFIG_KVM_AMD=m

# virtio
include frag/drivers/vfio
CONFIG_PCI_IOV=y
CONFIG_PCI_REALLOC_ENABLE_AUTO=y
include frag/drivers/iommu
CONFIG_AMD_IOMMU=y

include frag/fs/nfs
include frag/fs/btrfs
include frag/fs/squashfs
CONFIG_HFSPLUS_FS=m

CONFIG_TUN=m

include frag/extra/gentoo
