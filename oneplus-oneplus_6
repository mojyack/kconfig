set arch arm64
include frag/general

# arch
include frag/arch/arm64/general
include frag/arch/arm64/feats/armv8-1
include frag/arch/arm64/feats/armv8-2
include frag/arch/arm64/erratum/cortex-a55

CONFIG_CMDLINE_FORCE=y
CONFIG_CMDLINE="root=PARTUUID=d8e6753a-e694-66cc-f02f-d3030b86f5d2 rw rootwait loglevel=3 mitigations=off console=ttyMSM0,115200"

CONFIG_ARCH_QCOM=y
CONFIG_NR_CPUS=8

CONFIG_ARM64_4K_PAGES=y
CONFIG_ARM64_VA_BITS_48=y
CONFIG_ARM64_PA_BITS_48=y
CONFIG_CMA=y

CONFIG_ARM_QCOM_CPUFREQ_HW=y

# qrtr
CONFIG_QRTR=y
CONFIG_QRTR_SMD=m
CONFIG_QRTR_TUN=m

include frag/fs/nfs
include frag/extra/zram

### drivers ###
# bus
CONFIG_QCOM_EBI2=y

# firmware
CONFIG_ARM_SCPI_PROTOCOL=y
CONFIG_ARM_SCMI_PROTOCOL=y
CONFIG_ARM_SCMI_TRANSPORT_MAILBOX=y
CONFIG_ARM_SCMI_TRANSPORT_SMC=y
CONFIG_QCOM_QSEECOM=y
CONFIG_ARM_SMCCC_SOC_ID=y

# misc
CONFIG_QCOM_FASTRPC=m

# scsi and ufs
CONFIG_SCSI=y
CONFIG_BLK_DEV_SD=y
CONFIG_SCSI_UFSHCD=y
CONFIG_SCSI_UFS_BSG=y
# CONFIG_SCSI_UFS_CRYPTO=y
CONFIG_SCSI_UFSHCD_PLATFORM=y
CONFIG_SCSI_UFS_QCOM=y

# net
CONFIG_TUN=m
CONFIG_ETHERNET=y
CONFIG_NET_VENDOR_QUALCOMM=y
CONFIG_RMNET=m
CONFIG_QCOM_IPA=m

# usb net
CONFIG_USB_NET_DRIVERS=m
CONFIG_USB_USBNET=m
CONFIG_USB_NET_AX88179_178A=m

# wifi
CONFIG_WLAN=y
CONFIG_WLAN_VENDOR_ATH=y
CONFIG_ATH10K=m
CONFIG_ATH10K_SNOC=m

# bluetooth
include frag/net/wireless
include frag/net/bluetooth/uart
CONFIG_SERIAL_DEV_BUS=y
CONFIG_SERIAL_DEV_CTRL_TTYPORT=y  # required for bt!
CONFIG_BT_HCIUART_LL=y
CONFIG_BT_HCIUART_BCM=y
CONFIG_BT_HCIUART_QCA=y

CONFIG_EXTRA_FIRMWARE="qcom/a630_gmu.bin qcom/a630_sqe.fw qcom/sdm845/oneplus6/a630_zap.mbn"
CONFIG_EXTRA_FIRMWARE_DIR="/lib/firmware"

# input
CONFIG_KEYBOARD_GPIO=m
CONFIG_INPUT_PM8941_PWRKEY=m
CONFIG_INPUT_QCOM_SPMI_HAPTICS=m
CONFIG_INPUT_UINPUT=m
CONFIG_RMI4_CORE=m
CONFIG_RMI4_I2C=m
CONFIG_RMI4_F03=y
CONFIG_RMI4_F03_SERIO=m
CONFIG_RMI4_2D_SENSOR=y
CONFIG_RMI4_F11=y
CONFIG_RMI4_F12=y
CONFIG_RMI4_F30=y
CONFIG_RMI4_F55=y

# char
CONFIG_SERIAL_QCOM_GENI=y  # y because of link error 'undefined symbol: uart_parse_earlycon'
CONFIG_SERIAL_QCOM_GENI_CONSOLE=y

# i2c
CONFIG_I2C_CHARDEV=m
CONFIG_I2C_QCOM_CCI=m
CONFIG_I2C_QCOM_GENI=m
CONFIG_I2C_QUP=y

# spi
CONFIG_SPI=y
CONFIG_SPI_QUP=y

# spmi
CONFIG_SPMI=m
CONFIG_SPMI_MSM_PMIC_ARB=m

# pinctrl
CONFIG_PINCTRL_MSM=y
CONFIG_PINCTRL_SDM845=y
CONFIG_PINCTRL_QCOM_SPMI_PMIC=m

# gpio
include frag/drivers/gpio
CONFIG_GPIO_WCD934X=m

# power-reset
CONFIG_POWER_RESET=y
CONFIG_POWER_RESET_QCOM_PON=m

# power-supply
CONFIG_BATTERY_BQ27XXX=m
CONFIG_BATTERY_BQ27XXX_I2C=m
CONFIG_CHARGER_QCOM_SMB2=m

# hwmon
# TODO: disable hwmon
# CONFIG_HWMON=n

# thermal
CONFIG_QCOM_TSENS=m
CONFIG_QCOM_SPMI_TEMP_ALARM=m
CONFIG_QCOM_LMH=m

# wdt
include frag/drivers/watchdog
CONFIG_QCOM_WDT=m

# mfd
CONFIG_MFD_SPMI_PMIC=m
CONFIG_MFD_WCD934X=m

# regulator
CONFIG_REGULATOR=y
CONFIG_REGULATOR_FIXED_VOLTAGE=y
CONFIG_REGULATOR_GPIO=y
CONFIG_REGULATOR_PWM=y
CONFIG_REGULATOR_QCOM_RPMH=y
CONFIG_REGULATOR_QCOM_LABIBB=m

# media
CONFIG_MEDIA_PLATFORM_DRIVERS=y
CONFIG_V4L_PLATFORM_DRIVERS=y
CONFIG_VIDEO_QCOM_CAMSS=m
CONFIG_V4L_MEM2MEM_DRIVERS=y
CONFIG_VIDEO_QCOM_VENUS=m
CONFIG_VIDEO_CAMERA_SENSOR=y # TODO: enable sensors

# drm
CONFIG_DRM_MSM=y
CONFIG_DRM_MSM_DPU=y
CONFIG_DRM_MSM_DSI=y
CONFIG_DRM_MSM_DSI_10NM_PHY=y
CONFIG_DRM_PANEL_SAMSUNG_SOFEF00=y
CONFIG_BACKLIGHT_CLASS_DEVICE=y

# sound
CONFIG_SND_SOC=m
CONFIG_SND_SOC_QCOM=m
CONFIG_SND_HRTIMER=m
CONFIG_SND_SOC_QDSP6_Q6VOICE=m
CONFIG_SND_SOC_SDM845=m
CONFIG_SND_SOC_WCD934X=m

include frag/drivers/sound/usb

# usb
CONFIG_USB_ULPI_BUS=m
CONFIG_USB_OTG=y
CONFIG_USB_XHCI_HCD=m
CONFIG_USB_DWC3=m
CONFIG_USB_DWC3_ULPI=y
# CONFIG_USB_DWC3_DUAL_ROLE=y
CONFIG_USB_DWC3_QCOM=m
CONFIG_USB_ULPI=y
CONFIG_TYPEC=m
CONFIG_TYPEC_TCPM=m
CONFIG_TYPEC_TCPCI=m
CONFIG_TYPEC_QCOM_PMIC=m
CONFIG_USB_ROLE_SWITCH=m

# led
CONFIG_NEW_LEDS=y
CONFIG_LEDS_CLASS=m
CONFIG_LEDS_CLASS_FLASH=m
CONFIG_LEDS_CLASS_MULTICOLOR=m
CONFIG_LEDS_QCOM_FLASH=m
CONFIG_LEDS_QCOM_LPG=m

# rtc
include frag/drivers/rtc
CONFIG_RTC_DRV_PM8XXX=m

# dma
CONFIG_DMADEVICES=y
CONFIG_QCOM_BAM_DMA=y
CONFIG_QCOM_HIDMA_MGMT=y
CONFIG_QCOM_HIDMA=y

# staging
CONFIG_STAGING=y
CONFIG_STAGING_MEDIA=y
CONFIG_VIDEO_MAX96712=m

# common-clock
CONFIG_COMMON_CLK_SCMI=y
CONFIG_COMMON_CLK_SCPI=y
CONFIG_COMMON_CLK_PWM=y
CONFIG_COMMON_CLK_QCOM=y
CONFIG_QCOM_CLK_RPMH=y
CONFIG_SDM_CAMCC_845=m
CONFIG_SDM_GPUCC_845=y
CONFIG_SDM_VIDEOCC_845=y
CONFIG_SDM_DISPCC_845=y
CONFIG_SDM_LPASSCC_845=m

# hw-spinlock
CONFIG_HWSPINLOCK=y
CONFIG_HWSPINLOCK_QCOM=y

# timer
CONFIG_ARM_ARCH_TIMER_EVTSTREAM=y

# mailbox
CONFIG_MAILBOX=y
CONFIG_QCOM_APCS_IPC=y

# iommu
CONFIG_IOMMU_SUPPORT=y
CONFIG_IOMMU_DEFAULT_DMA_STRICT=y
CONFIG_ARM_SMMU=y
CONFIG_ARM_SMMU_DISABLE_BYPASS_BY_DEFAULT=y
CONFIG_ARM_SMMU_V3=y
CONFIG_QCOM_IOMMU=y

# remoteproc
CONFIG_REMOTEPROC=y
CONFIG_REMOTEPROC_CDEV=y
CONFIG_QCOM_Q6V5_ADSP=m
CONFIG_QCOM_Q6V5_MSS=m
CONFIG_QCOM_Q6V5_PAS=m
CONFIG_QCOM_SYSMON=m

# rpmsg
CONFIG_RPMSG_CHAR=m
CONFIG_RPMSG_CTRL=m
CONFIG_RPMSG_QCOM_GLINK_SMEM=m
CONFIG_RPMSG_QCOM_SMD=m

# soundwire
CONFIG_SOUNDWIRE=m
CONFIG_SOUNDWIRE_QCOM=m

# soc
CONFIG_QCOM_AOSS_QMP=y
CONFIG_QCOM_COMMAND_DB=y
CONFIG_QCOM_GENI_SE=y
CONFIG_QCOM_GSBI=y
CONFIG_QCOM_LLCC=y
CONFIG_QCOM_OCMEM=y
CONFIG_QCOM_PD_MAPPER=m
CONFIG_QCOM_RMTFS_MEM=y
CONFIG_QCOM_RPMH=y
CONFIG_QCOM_SMEM=y
CONFIG_QCOM_SMP2P=y
CONFIG_QCOM_SOCINFO=y
# CONFIG_QCOM_STATS=m
CONFIG_QCOM_APR=m
CONFIG_QCOM_ICC_BWMON=m

# pm domain
CONFIG_ARM_SCMI_POWER_DOMAIN=y
CONFIG_ARM_SCPI_POWER_DOMAIN=y
CONFIG_QCOM_RPMHPD=y

# iio
CONFIG_IIO=m
CONFIG_QCOM_SPMI_RRADC=m
CONFIG_QCOM_SPMI_ADC5=m

# pwm
CONFIG_PWM=y

# irq chip
CONFIG_QCOM_PDC=y
CONFIG_QCOM_MPM=y

# reset controller
CONFIG_RESET_QCOM_AOSS=y
CONFIG_RESET_QCOM_PDC=m
CONFIG_RESET_SCMI=y

# phy
CONFIG_PHY_QCOM_QMP=y
CONFIG_PHY_QCOM_QMP_UFS=y
CONFIG_PHY_QCOM_QMP_USB=y
CONFIG_PHY_QCOM_QUSB2=y

# pmu
CONFIG_ARM_PMU=y

# nvmem
CONFIG_NVMEM_SYSFS=y
CONFIG_NVMEM_QCOM_QFPROM=m

# tee
CONFIG_TEE=m
CONFIG_OPTEE=m

# slimbus
CONFIG_SLIMBUS=y
CONFIG_SLIM_QCOM_CTRL=y
CONFIG_SLIM_QCOM_NGD_CTRL=m

# inter-connect
CONFIG_INTERCONNECT_QCOM=y
CONFIG_INTERCONNECT_QCOM_OSM_L3=m
CONFIG_INTERCONNECT_QCOM_SDM845=y
