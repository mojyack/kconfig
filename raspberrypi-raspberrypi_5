set arch arm64
include frag/general

# arch
include frag/arch/arm64/general
include frag/arch/arm64/feats/armv8-1
include frag/arch/arm64/feats/armv8-2
include frag/arch/arm64/erratum/cortex-a76

erase CONFIG_ARM64_ERRATUM_1418040 # !COMPAT

CONFIG_ARCH_BCM=y
CONFIG_ARCH_BCM2835=y
CONFIG_ARCH_BRCMSTB=y
CONFIG_NR_CPUS=4

CONFIG_ARM64_4K_PAGES=y
CONFIG_PAGE_BLOCK_ORDER=10 # "11" if 16K, "13" if 64K
CONFIG_ARM64_VA_BITS_48=y
CONFIG_ARM64_PA_BITS_48=y
CONFIG_CMA=y

CONFIG_CPUFREQ_DT=m
CONFIG_ARM_RASPBERRYPI_CPUFREQ=m

include frag/fs/nfs
include frag/extra/zram

### drivers ###
# pci
include frag/drivers/pci
CONFIG_PCIE_BRCMSTB=y

# firmware
CONFIG_RASPBERRYPI_FIRMWARE=y
CONFIG_FIRMWARE_RP1=m
CONFIG_ARM_SMCCC_SOC_ID=y

# of
CONFIG_OF_CONFIGFS=y

# misc
CONFIG_RP1_PIO=m
CONFIG_SRAM=y

# net
CONFIG_TUN=m
CONFIG_ETHERNET=y
CONFIG_NET_VENDOR_CADENCE=y
CONFIG_MACB=m
CONFIG_MACB_USE_HWSTAMP=y

# usb net
CONFIG_USB_NET_DRIVERS=m
CONFIG_USB_USBNET=m
CONFIG_USB_NET_AX88179_178A=m

# wifi
CONFIG_WLAN=y
CONFIG_WLAN_VENDOR_BROADCOM=y
CONFIG_BRCMFMAC=m
CONFIG_BRCMFMAC_SDIO=y

# bluetooth
include frag/net/wireless
include frag/net/bluetooth/uart
CONFIG_BT_HCIUART_BCM=y

# input
CONFIG_KEYBOARD_GPIO=m

# char
CONFIG_BRCM_CHAR_DRIVERS=y
CONFIG_BCM2708_VCMEM=y
CONFIG_BCM_VCIO=m
CONFIG_SERIAL_8250=m
CONFIG_SERIAL_8250_BCM7271=m
CONFIG_SERIAL_AMBA_PL011=m
CONFIG_SERIAL_DEV_BUS=m  # CONFIG_BT_HCIUART_BCM
CONFIG_HW_RANDOM=m
CONFIG_HW_RANDOM_IPROC_RNG200=m

# i2c
CONFIG_I2C=y
CONFIG_I2C_BCM2835=m
CONFIG_I2C_BRCMSTB=m
CONFIG_I2C_DESIGNWARE_CORE=m
CONFIG_I2C_DESIGNWARE_PLATFORM=m

# spi
CONFIG_SPI=y
CONFIG_SPI_BCM2835=m
CONFIG_SPI_SPIDEV=m
CONFIG_SPI_DESIGNWARE=m
CONFIG_SPI_DW_DMA=y
CONFIG_SPI_DW_MMIO=m

# ptp
CONFIG_PTP_1588_CLOCK=m

# pinctrl
CONFIG_PINCTRL_RP1=y
CONFIG_PINCTRL_BCM2712=y

# gpio
CONFIG_GPIO_BCM_VIRT=y
CONFIG_GPIO_BRCMSTB=y

# power-reset
CONFIG_POWER_RESET_GPIO=y

# hwmon
CONFIG_SENSORS_RASPBERRYPI_HWMON=m
CONFIG_SENSORS_RP1_ADC=m

# thermal
CONFIG_BCM2711_THERMAL=y

# wdt
include frag/drivers/watchdog
CONFIG_BCM2835_WDT=m

# mfd
CONFIG_MFD_SYSCON=y
CONFIG_MFD_RP1=y

# regulator
CONFIG_REGULATOR=y
CONFIG_REGULATOR_FIXED_VOLTAGE=y
CONFIG_REGULATOR_GPIO=y

# media
CONFIG_MEDIA_PLATFORM_DRIVERS=y
CONFIG_V4L_PLATFORM_DRIVERS=y
# CONFIG_VIDEO_BCM2835_UNICAM_LEGACY=m
CONFIG_VIDEO_BCM2835_UNICAM=m
CONFIG_VIDEO_RP1_CFE=m
CONFIG_VIDEO_RASPBERRYPI_PISP_BE=m
CONFIG_VIDEO_RPI_HEVC_DEC=m
# CONFIG_VIDEO_CAMERA_SENSOR=y
# CONFIG_VIDEO_IMX219=m

# drm
CONFIG_DRM_V3D=m
CONFIG_DRM_VC4=m
CONFIG_DRM_VC4_HDMI_CEC=y
CONFIG_DRM_RP1_DSI=m
CONFIG_DRM_RP1_DPI=m
CONFIG_DRM_RP1_VEC=m
CONFIG_FB_BCM2708=y

# sound
CONFIG_SND_SOC=m
CONFIG_SND_RP1_AUDIO_OUT=m
CONFIG_SND_DESIGNWARE_I2S=m
CONFIG_SND_DESIGNWARE_PCM=y

include frag/drivers/sound/usb

# usb
CONFIG_USB_XHCI_HCD=m
CONFIG_USB_DWC3=m
CONFIG_NOP_USB_XCEIV=m

# mmc
CONFIG_MMC=y
CONFIG_MMC_BLOCK=y
CONFIG_MMC_SDHCI=y
CONFIG_MMC_SDHCI_PLTFM=y
CONFIG_MMC_SDHCI_OF_DWCMSHC=y
CONFIG_MMC_SDHCI_BRCMSTB=y

# led
CONFIG_NEW_LEDS=y
CONFIG_LEDS_CLASS=m
CONFIG_LEDS_GPIO=m

# rtc
include frag/drivers/rtc
CONFIG_RTC_DRV_RPI=m

# dma
CONFIG_DMADEVICES=y
CONFIG_DMA_BCM2835=y
CONFIG_DW_AXI_DMAC=m

# common-clock
CONFIG_COMMON_CLK_RP1=y
CONFIG_COMMON_CLK_RP1_SDIO=y
CONFIG_CLK_BCM2711_DVP=y
CONFIG_CLK_RASPBERRYPI=y

# timer
CONFIG_ARM_ARCH_TIMER_EVTSTREAM=y
CONFIG_ARM64_ERRATUM_858921=y

# mailbox
CONFIG_MAILBOX=y
CONFIG_BCM2835_MBOX=y
CONFIG_MBOX_RP1=m

# iommu
CONFIG_IOMMU_SUPPORT=y
CONFIG_IOMMU_DEFAULT_PASSTHROUGH=y
CONFIG_BCM2712_IOMMU=y

# soc
CONFIG_SOC_BRCMSTB=y

# pm domain
CONFIG_BCM2835_POWER=y
CONFIG_RASPBERRYPI_POWER=y

# pwm
CONFIG_PWM=y
CONFIG_PWM_PIO_RP1=m
CONFIG_PWM_RP1=m

# irq
CONFIG_BCM2712_MIP=y
CONFIG_BRCMSTB_L2_IRQ=y

# reset
CONFIG_RESET_BRCMSTB=y
CONFIG_RESET_BRCMSTB_RESCAL=y
CONFIG_RESET_RASPBERRYPI=y

# pmu
CONFIG_ARM_PMU=y
CONFIG_RPI_AXIPERF=m

# nvmem
CONFIG_NVMEM=y
CONFIG_NVMEM_RASPBERRYPI_OTP=m
CONFIG_NVMEM_RMEM=m
